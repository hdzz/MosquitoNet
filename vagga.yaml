containers:
  build:
    setup:
    - !UbuntuRelease { version: 15.10 }
    - !UbuntuUniverse
    - !Install [ make, cmake, clang, gcc, g++, libboost-all-dev, ca-certificates, gdbserver ]
    volumes:
      /tmp: !Tmpfs {size: 1Gi}

commands:
  build: !Command
    description: Build C++
    accepts-arguments: false
    container: build
    work-dir: .
    run: |
      mkdir -p build/gcc
      cd build/gcc
      cmake ../..
      make -j 8
  build-clang: !Command
    description: Build C++ with clang
    accepts-arguments: false
    container: build
    work-dir: .
    environ: { CXX: clang++-3.6, CC: clang-3.6 }
    run: |
      mkdir -p build/clang
      cd build/clang
      cmake ../..
      make -j 8
  test: !Command
    description: Run tests
    accepts-arguments: true
    container: build
    work-dir: .
    run: |
      build/gcc/test-harness "$@"
  test-clang: !Command
    description: Run tests built with clang
    accepts-arguments: true
    container: build
    work-dir: .
    run: |
      build/clang/test-harness "$@"

